+++
title = "0.79.0 Release Notes"
date = 2022-09-19
+++

## 1. Table of Contents

- [1. Table of Contents](#1-table-of-contents)
- [2. Upgrade!](#2-upgrade)
- [3. Audio improvements](#3-audio-improvements)
  - [3.1. AdLib Gold Surround Module emulation](#31-adlib-gold-surround-module-emulation)
  - [3.2. Sound card output filter emulation](#32-sound-card-output-filter-emulation)
  - [3.3. Crossfeed](#33-crossfeed)
  - [3.4. Reverb \& Chorus](#34-reverb--chorus)
  - [3.5. Master compressor](#35-master-compressor)
  - [3.6. General mixer improvements](#36-general-mixer-improvements)
  - [3.7. "One OPL mode to rule them all" 💍](#37-one-opl-mode-to-rule-them-all-)
  - [3.8. FluidSynth configuration changes](#38-fluidsynth-configuration-changes)
  - [3.9. ripa's PC speaker patch](#39-ripas-pc-speaker-patch)
  - [3.10. Parallel port DAC models: Disney, Covox, and Stereo-On-1](#310-parallel-port-dac-models-disney-covox-and-stereo-on-1)
  - [3.11. Audio mute and pause](#311-audio-mute-and-pause)
- [4. Graphical improvements](#4-graphical-improvements)
  - [4.1. Shortcut to reload current shader](#41-shortcut-to-reload-current-shader)
  - [4.2. Override default CGA palette](#42-override-default-cga-palette)
  - [4.3. Scaled image quality improvements](#43-scaled-image-quality-improvements)
  - [4.4. High DPI on macOS](#44-high-dpi-on-macos)
  - [4.5. Window transparency support](#45-window-transparency-support)
  - [4.6. Configurable frame presentation modes](#46-configurable-frame-presentation-modes)
- [5. DOS Shell Improvements](#5-dos-shell-improvements)
  - [5.1. Piping from the DOS prompt or batch files](#51-piping-from-the-dos-prompt-or-batch-files)
  - [5.2. File attribute support and ATTRIB command](#52-file-attribute-support-and-attrib-command)
  - [5.3. Setting default choices for CHOICE command](#53-setting-default-choices-for-choice-command)
- [6. Mount Improvements](#6-mount-improvements)
  - [6.1. Physical CDs mounting support](#61-physical-cds-mounting-support)
  - [6.2. Allow read-only mount of disk images](#62-allow-read-only-mount-of-disk-images)
  - [6.3. Z drive customization and directory support](#63-z-drive-customization-and-directory-support)
  - [6.4. Wildcard support for IMGMOUNT command](#64-wildcard-support-for-imgmount-command)
  - [6.5. Automount resource drives](#65-automount-resource-drives)
- [7. Localization improvements](#7-localization-improvements)
  - [7.1. Code pages and keyboard layouts](#71-code-pages-and-keyboard-layouts)
  - [7.2. Country support for different date, time, and decimal formats](#72-country-support-for-different-date-time-and-decimal-formats)
  - [7.3. Improved detection of local language and keyboard layout](#73-improved-detection-of-local-language-and-keyboard-layout)
- [8. Input improvements](#8-input-improvements)
  - [8.1. Mouse wheel emulation](#81-mouse-wheel-emulation)
  - [8.2. Serial mice emulation](#82-serial-mice-emulation)
  - [8.3. Windows 3.1 seamless mouse integration](#83-windows-31-seamless-mouse-integration)
  - [8.4. Joystick calibration hotkeys](#84-joystick-calibration-hotkeys)
- [9. General improvements](#9-general-improvements)
  - [9.1. Launch with specified config option(s) from command-line](#91-launch-with-specified-config-options-from-command-line)
  - [9.2. Implemented Windows installer for Windows users](#92-implemented-windows-installer-for-windows-users)
  - [9.3. Configurable soft-modem connect speed](#93-configurable-soft-modem-connect-speed)
  - [9.4. Workaround for games that corrupt memory](#94-workaround-for-games-that-corrupt-memory)
- [10. Developer-related improvements](#10-developer-related-improvements)
  - [10.1. Self-documenting bit-twidling with `bit_view`](#101-self-documenting-bit-twidling-with-bit_view)
  - [10.2. Memory block and type size simplification](#102-memory-block-and-type-size-simplification)
  - [10.3. Tracy profiler integration](#103-tracy-profiler-integration)
  - [10.4. Continous Integration MSYS2 workflow improvements](#104-continous-integration-msys2-workflow-improvements)
  - [10.5. Release-package shell script](#105-release-package-shell-script)
  - [10.6. Static analysis](#106-static-analysis)
- [11. Translation Updates](#11-translation-updates)
- [12. Bugfixes](#12-bugfixes)
- [13. Contributors](#13-contributors)
- [14. Thank You](#14-thank-you)


## 2. Upgrade!

Download and launch the latest version:

* [Linux](/downloads/linux/) (or [Steam on Linux](/downloads/linux#steam))
* [Windows](/downloads/windows/)
* [macOS](/downloads/macos/)

At the DOSBox `C:\>` prompt, run: `config -wc` to upgrade your config file. Your existing settings will be retained, however extraneous comments will be dropped.

## 3. Audio improvements

### 3.1. AdLib Gold Surround Module emulation

The ultra-rare AdLib Gold surround sound daughterboard is now fully emulated, which makes it possible to finally enjoy the [Dune soundtrack](https://www.youtube.com/playlist?list=PLDE06DE88BB135F33) in its full glory! That's the only game in existence that makes use of the surround module.

The following config is recommended for [Dune](https://en.wikipedia.org/wiki/Dune_(video_game)). The setup utility should auto-detect AdLib Gold and the surround module correctly with these settings.

```ini
[sblaster]
sbtype = sb16
oplmode = opl3gold
```

### 3.2. Sound card output filter emulation

Most DOS-era sound cards feature an output low-pass filter (and sometimes a high-pass filter too) that play an important role in giving their sound its character. DOSBox Staging can now accurately emulate these analog output stage filters for all supported sound devices.

#### Sound Blaster

For backward compatibility reasons, the `sb_filter` config parameter defaults to the newly introduced `modern` filter, which uses the simple linear interpolation method of previous DOSBox versions. To turn on accurate analog output filter emulation, set the `sb_filter` to `auto`. This will set the correct filters for each Sound Blaster model depending on the `sb_type` value. You can also set a model-specific filter manually if you wish, e.g. this is how to use a Sound Blaster 16 but with Sound Blaster Pro filters:

```ini
[sblaster]
sbtype = sb16
sb_filter = sbpro1
```

Some Sound Blaster models can toggle the filter on and off in software; you can force the filter to be always on by setting `sb_filter_always_on` to `true`.

OPL and CMS filters are also accurately emulated; please refer to the descriptions of the `opl_filter` and `cms_filter` config parameters for further details.

#### Small-speaker systems

Filters are enabled by default for all small-speaker audio systems (PC Speaker, PS/1 Audio, Tandy, and the various LPT DAC options). Depending on the particular device, these filters either emulate the analog output filters of the original device, or the sound coming out of a small band-limited speaker in an acoustic environment. Either way, the result is a more period-accurate and pleasant listening experience, especially on headphones.

Small-speaker filters are controlled by the following config parameters:

* `lpt_dac_filter`
* `pcspeaker_filter`
* `ps1audio_dac_filter`
* `ps1audio_filter`
* `tandy_dac_filter`
* `tandy_filter`

#### Custom filters

Advanced users can specify custom filter settings for any of the supported sound devices. You can specify either a high-pass filter, a low-pass filter, or both at the same time using the following format

 TYPE ORDER FREQ [TYPE ORDER FREQ]

where **TYPE** can be `hpf` (high-pass) or `lpf` (low-pass), **ORDER** is the order of the filter from 1 to 16 (1st order results in a 6dB per octave slope, 2nd order in a 12dB per octave slope, etc.), and **FREQ** is the filter's cutoff frequency in Hz.

For example, to use a 2nd order (12dB/oct) low-pass filter at 8 kHz for the Sound Blaster:

```ini
sb_filter = lpf 2 8000
```

To use a 3rd order (18dB/oct) high-pass filter at 120 Hz, and a 1st order (6dB/oct) low-pass filter at 6.5 kHz for the PC Speaker:

```ini
pcspeaker_filter = hpf 3 120 lfp 1 6500
```

In addition to the sound devices mentioned above, you use custom filters even with devices that don't filter the output in the original hardware (e.g. GUS, MT-32), and the FluidSynth virtual MIDI device via the following config parameters:

* `fsynth_filter`
* `gus_filter`
* `innovation_filter`
* `mt32_filter`

### 3.3. Crossfeed

Listening to audio material on headphones where certain sounds are only present in either the left or the right channel can be a rather distracting and unpleasant experience. This is most noticeable on certain Dual OPL game soundtracks and tracker music (e.g. MOD, XM, S3M, IT, etc.)

The new crossfeed feature remedies that; by enabling `crossfeed` in the `[mixer]` section, a certain percentage of the left channel is mixed into the right, and vice versa. The default crossfeed strength is 40% which is a good general setting, but you can provide a custom percentage value as well (e.g. `crossfeed = 55`).

The amount of crossfeed can be fine-tuned per individual channels via mixer commands; please type `MIXER /?` in the DOSBox prompt for further details.

### 3.4. Reverb & Chorus

#### Reverb

One of the most exciting new audio features is the ability to add reverb (the emulation of real acoustic spaces) and chorus effects to any mixer channel. This can add a lot of atmosphere to dry-sounding synth soundtracks (typically OPL music) and elevate them to a whole new level! Enabling reverb and chorus processing is especially useful for headphone-listening.

The quickest way to enable the **reverb effect** globally is to put `reverb = on` in the `[mixer]` config section. This will add reverb to all synth channels (e.g. PC Speaker, OPL, CMS), and a lesser amount to digital audio channels (e.g. Sound Blaster, GUS). While the default setting works well in most games, it's highly recommended to experiment with the five available reverb presets to find the optimal setting for each game:

* `tiny` simulates the sound of a small integrated speaker in a domestic room. This preset is specifically tailored for small-speaker audio systems (PC Speaker, Tandy, PS/1 Audio, and LPT DAC devices).

* `small` adds a subtle sense of space; it's best suited for games that use a single synth channel (typically OPL) for both the music and the sound effects.

* `medium` is the default preset; it's a middle-of-the-road setting that works well with a wide variety of games.

* `large` is a large hall style reverb that is recommended for games that use separate audio channels for music and digital audio (e.g. OPL audio and Sound Blaster digital sound.)

* `huge` is a stronger variant of the large hall preset which is ideal for slower paced, atmospheric music.

#### Chorus

Another way to add a sense of space to the sound is by enabling the **chorus effect**. This adds stereo movement and increases the perceived stereo width, which is especially noticeable on purely mono signals on headphones (e.g. PC Speaker or OPL2 music). To enable it, just put `chorus = on` into the `[mixer]` config section, or select one of three predefined chorus strength presets, `light`, `normal` or `strong`.

Similarly to crossfeed, per-channel reverb and chorus settings can be tweaked by mixer commands; please type `MIXER /?` in the DOSBox prompt for details.

#### Audio examples

Naturally, you can combine chorus and reverb, and it's not only possible to do so, but highly recommended for achieving the best results! The below recordings showcase how crossfeed, reverb, chorus, and output stage filters can work in tandem to give old DOS game soundtracks a new life.

The exact settings used for these recordings are documented [on the Wiki](https://github.com/dosbox-staging/dosbox-staging/wiki/Audio-configuration-recommendations), along with suggested audio configs for many other games. Make sure to check them out and experiment with the settings yourself! :sunglasses: :speaker: :headphones:

Game | Type | Audio Example
--- | --- | ---
Alone in the Dark<br>(floppy version) | OPL2| <audio controls src="/alone-in-the-dark.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Warcraft | OPL3 | <audio controls src="/warcraft.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Dungeon Master II:<br>The Legend of Skullkeep | Dual&nbsp;OPL2 | <audio controls src="/dungeon-master-ii.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Ultima Underworld I: The Stygian Abyss | Dual OPL2 | <audio controls src="/ultima-underworld-i.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Elvira: Mistress of the Dark | Dual&nbsp;OPL2 | <audio controls src="/elvira.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Skate or Die! | Tandy | <audio controls src="/skate-or-die.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Zak McKracken and the Alien Mindbenders | Tandy | <audio controls src="/zak.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
Budokan - The Martial Spirit | CMS |  <audio controls src="/budokan.mp3"> Your browser does not support the <code>audio</code> element.  </audio>
The Secret of Monkey Island | CMS |  <audio controls src="/monkey-island.mp3"> Your browser does not support the <code>audio</code> element. </audio>


### 3.5. Master compressor

An auto-leveling dynamic range compressor has been introduced to the master channel to ensure that the audio output never gets distorted, no matter how high the volume levels are. This is on by default, and is virtually transparent when the output is not driven into clipping. However, purists can disable it by setting `compressor` to `off`, and then ensure correct non-clipping output levels manually.

### 3.6. General mixer improvements

* The mixer now uses a full floating-point processing path internally, which means you can no longer overload individual mixer channels into clipping by using high per-channel volume settings. As long as the summed master output is not clipping, it's guaranteed that nothing else will.

* A fixed high-pass filter at 20 Hz has been introduced right before the final output that gets rid of any DC-offset and subsonic rumble globally.

* The `MIXER` command has received an overhaul too. First of all, the status output looks better, and the following improvements have been made:

  * Now you can set reverb, chorus, and crossfeed levels per mixer channel; type `MIXER /?` in the DOSBox prompt for further details.
  * The `FM` channel has been renamed to `OPL`.
  * The `SPKR` channel has been renamed to `PCSPEAKER`.
  * The sample rate column has been removed (it served no useful purpose, and the displayed values were often technically correct but misleading).

### 3.7. "One OPL mode to rule them all" &#128141;

NukedOPL has long been the default OPL mode in Staging. As it's basically a bit-perfect emulation of the [Yamaha YMF262 OPL3 chip](https://en.wikipedia.org/wiki/Yamaha_OPL#OPL3), and it runs fast enough even on low-end hardware such as the Raspberry Pi 4, all other less accurate OPL emulation modes have been removed.

### 3.8. FluidSynth configuration changes

#### Reverb & Chorus

Due to the introduction of the new mixer-level [reverb and chorus effects](#ReverbChorus), the FluidSynth `reverb` and `chorus` config parameters have been renamed to `fsynth_reverb` and `fsynth_chorus`, respectively.

To maintain backward compatibility with existing configurations, the FluidSynth reverb and chorus effects are enabled by default, so all your SoundFonts will sound just like in previous DOSBox versions. If you enable the mixer-level reverb (or chorus) as well (e.g. by putting `reverb = on` in the `[mixer]` section), you would get a *second* round of reverb (or chorus) processing on the FluidSynth output. This is by design as it allows users the greatest level of control over customising SoundFonts (e.g. some would sound best with the FluidSynth reverb only, some with both, etc.)

Note that in the SF2 format the reverb and chorus amounts are specified on a per-instrument basis, while the mixer-level effects are applied "globally" to all instruments in the summed FluidSynth output.
Therefore, what works best really depends on the particular SoundFont in question and on individual user preference (see [this discussion](TODO) for further technical details).

#### Volume scaling

Previously, it was possible to specify a percentage after the SoundFont's name in the config to adjust its volume (e.g. `soundfont = way_too_loud.sf2 30`). This was introduced as a workaround for certain loud SoundFonts that had a tendency to clip the mixer channel internally.

With the floating-pointing mixer signal path it's no longer possible to drive any of the mixer channels into clipping, therefore this workaround has been deprecated. Please use standard mixer commands to lower the volume of the `FSYNTH` channel if you wish to do so.

### 3.9. ripa's PC speaker patch

We've integrated ripa's impulse-model [PC speaker patch](https://www.vogons.org/viewtopic.php?f=41&t=23371) alongside DOSBox's existing (discrete-model) PC speaker implementation, which is still the default.

To use it, set the `pcspeaker` conf setting to `impulse` (or go back to default with `discrete`).

James-F and VileRancour have mentioned in the linked thread that it generally improves accuracy of  square-wave effects, such as in Commander Keen and Duke Nukem (2D). This patch also can produce sounds when none previously existed, such as in Wizball, as noted by ripsaw8080.

For example, here's Wizball using the settings below:

```ini
[mixer]
rate = 32000

[speaker]
pcspeaker = discrete
```

<video controls src="/pcspeaker_impulse_wizball.webm" width=640> Your browser does not support the <code>video</code> element. </video>

Note: There are some audible regressions and harmonics that still exist in some games, so that's why this is an alternative and not the default.

### 3.10. Parallel port DAC models: Disney, Covox, and Stereo-On-1

Those familiar with DOSBox know that these three devices are emulated with the universal `disney = true` setting.

Like `sbtype =`, we wanted the model of LPT DAC to be configurable, and so Staging's deprecated the `disney` setting in favour of `lpt_dac =` that takes any of the following:

* `disney`, for the Disney Sound Source.
* `covox`, for the Covox Speech Thing.
* `ston1`, for the Stereo-on-1 DAC device.
* `off/none`, to disable the DAC (default)

This is paired with a corresponding filter setting, `lpt_dac_filter`, which approximates how the original device sounded. This means that the Disney Sound Source (which included its own little speaker inside it) will sound a lot like you might remember.

| `lpt_dac=` | Examples (ModPlay Pro & Star Control II's 8-bit Pkunk MOD)                                                                       |
| -----------| -------------------------------------------------------------------------------------------------------------------------------- |
| `"disney"` | <audio controls src="/modplay_pkunk_lpt_dac_disney.flac"> Your browser does not support the <code>audio</code> element. </audio> |
| `"covox"`  | <audio controls src="/modplay_pkunk_lpt_dac_covox.flac"> Your browser does not support the <code>audio</code> element. </audio>  |
| `"ston1"`  | <audio controls src="/modplay_pkunk_lpt_dac_ston1.flac"> Your browser does not support the <code>audio</code> element. </audio>  |

Like the other [filter settings](#SoundOutputFilters), `lpt_dac_filter` can be toggled on, off, or customized with your own settings.

### 3.11. Audio mute and pause

The audio stream can now be manually muted with **Ctrl + F8** (or **Cmd + F8** on macOS).

You can also mute the audio automatically when DOSBox Staging goes to the background with this conf setting:

```ini
[sdl]
mute_when_inactive = true
```

Or you can pause emulation entirely when in the background with:

```ini
[sdl]
pause_when_inactive = true
```

## 4. Graphical improvements

### 4.1. Shortcut to reload current shader

As DOSBox Staging currently lacks a shader preset system, tweaking shader parameters can only be accomplished by making changes to the shader source files themselves. Previously, you had to restart DOSBox to see the effects of such changes, which made fine-tuning shaders quite cumbersome, to say the least.

Now you can just use the **Ctrl + F2** shortcut (**Cmd + F2** on macOS) to reload the current shader any time. Progress! :sunglasses:

### 4.2. Override default CGA palette

Now it is possible to override the default, canonical interpretation of the 16-colour CGA/EGA RGBI palette. The feature overrides the CGA colours in any CGA/EGA-like mode, so it even works in CGA/EGA modes on an emulated VGA card, or on the Tandy.

A number of presets have been included (e.g. Amiga and Atari ST colours for Sierra games, and various CGA/EGA monitor emulations), and you can specify custom palettes as well. Make sure to check out the description of the `cga_colors` config parameter for the list of available presets (you can read more about them
[here](https://github.com/dosbox-staging/dosbox-staging/pull/1794)).

#### Defender of the Crown

_`tandy-warm` emulates the colours as they appear on an actual Tandy monitor, which results in more subdued and pleasant colours. This is especially apparent on the greens._

default | tandy-warm
--- | ---
[![Defender of the Crown (default)](/dotc-default.png)](/dotc-default.png) | [![Defender of the Crown (tandy-warm)](/dotc-tandy-warm.png)](/dotc-tandy-warm.png)

#### Gold Rush

*The Amiga/Atari ST ports of Sierra AGI games feature a tweaked CGA palette with improved skin-tones and sky colours.*

default | agi-amigaish
--- | ---
[![Gold Rush! (default)](/gold-rush-default.png)](/gold-rush-default.png) | [![Gold Rush! (agi-amigaish)](/gold-rush-agi-amigaish.png)](/gold-rush-agi-amigaish.png)

#### Zak McKracken and the Alien Mindbenders

*Now you can play the PC version of this classic adventure with Tandy sound and Commodore 64 colours!*

default | colodore
--- | ---
[![Zak McKracken (default)](/zak-default.png)](/zak-default.png) | [![Zak McKracken (colodore)](/zak-colodore.png)](/zak-colodore.png)

### 4.3. Scaled image quality improvements

TODO

### 4.4. High DPI on macOS

The backstory: DOSBox Staging uses OpenGL output with the sharp bilinear scaling shader to keep the picture crisp no matter how big or small the image is, and minimize blurring on pixel transitions.

Due to the way MacOS handles DPI scaling, the image is actually drawn at a much lower resolution, usually just a quarter of the window size. Then it was stretched by the system, producing an unpleasantly mushy presentation. But we want our pixels to be so sharp they could cut one's eyes.

Before | After
--- | ---
[![DOSBox Staging on macOS without hiDPI support](/non_hidpi_win31.png)](/non_hidpi_win31.png) | [![DOSBox Staging on macOS with hiDPI support](/hidpi_win31.png)](/hidpi_win31.png)

Click to view full-size images.

Now DOSBox Staging is able to handle high DPI displays, be it Retina or not, so you and shaders alike can see all the (physical) pixels.

Please note that this is currently experimental: only macOS is currently supported, and we haven't thoroughly tested multi-display setups. Please report any weird behaviour! Support for Windows will come in the future, and for Linux it is still uncertain. Also note that due to the way rendering is currently implemented, you may observe lowered performance on higher resolution displays, especially when running off integrated graphics. This might be remedied in the future as well.

### 4.5. Window transparency support

There might be situations where you want to place the DOSBox Staging window on top of another window while seeing both windows at the same time. Indeed, you can now set the DOSBox Staging window as transparent, with a customized level of window transparency, so that you can see the background window as well. There is a new config option `transparency` for this, whose valid values are between `0` (no transparency; default) to `90` (high transparency).

### 4.6. Configurable frame presentation modes

Background: DOSBox presents frames when new content is available, which means that sometimes the effective frame rate can vary between 0 FPS (if the screen content isn't changing) and as fast as the DOS vblank rate (typically up to ~70 Hz). We'll call this presentation mode "Variable Frame Rate" or VFR.

In addition to VFR, DOSBox Staging supports a Constant Frame Rate (CFR) presentation mode, which presents a constant frame rate defined by the emulated DOS rate, as well as variations on both:

* Synced CFR, which presents a constant frame rate but synchronized with the host's refresh rate. This presents only the most recently updated frame when the DOS rate exceeds the host rate.

* Throttled VFR, which presents a variable frame rate up to the DOS rate throttled to the display's rate. This presents only the most recently updated frame when the DOS rate exceeds the host rate.

By default, DOSBox Staging inspects runtime conditions and picks the optimal presentation mode.

[![Earthworm Jim (synced CFR)](/synced_cfr_ewj.png)](/zsynced_cfr_ewj.png)

*Synced CFR mode selected due to vsync-enforced video drivers*

Although typically not needed, power-users might be interested in forcing a given mode or rate, which can be done using the following conf settings (which includes detailed description in the conf):

```ini
[sdl] presentation_mode = auto / cfr / vfr
[sdl] host_rate = auto / sdi / vrr / custom-rate
[dosbox] dos_rate = default / host / custom-rate
```

## 5. DOS Shell Improvements

### 5.1. Piping from the DOS prompt or batch files

DOSBox did not support the piping operation previously, but DOSBox Staging now brings piping support as how it has worked in DOS and most other operating systems. This allows two or more commands to communicate by passing the output text of one command to another as its input text. For example, commands like `TYPE FILE.TXT | MORE` will work (provided that you have the `MORE` command from MS-DOS or FreeDOS), so that you will be able to display the content of `FILE.TXT` one screen at a time, Multiple piping is also supported, such as `DIR | SORT | MORE`. If the current directory and `C:\` are both read-only, the environment variable `%TEMP%`` (or`%TMP%) need to be set within DOS pointing to a writable directory so that piping will work properly (e.g. `SET TEMP=C:\TEMP`).

### 5.2. File attribute support and ATTRIB command

File attributes contain information about how the files should be used, and in DOS these correspond to Archive (`A`), Read-only (`R`), Hidden (`H`), and System (`S`) attributes. DOSBox Staging now adds support for file attributes through `ATTRIB` command (type `ATTRIB /?` for more information about this command) or through DOS API that accesses to file attributes. For example, some game installers and applications make use of file attributes. All file attributes are currently supported with the exception of system and hidden attributes on mounted local drives for non-Windows platforms.

### 5.3. Setting default choices for CHOICE command

The `CHOICE` command allows you to make a choice from a list of options, but sometimes you want to have some default choice if no selection is made within the specific time period. DOSBox Staging now allows you to do this, by specifying the `/T` option which includes a default choice and the time period in seconds. For example, `CHOICE /C:ABC /T:B,2` will default to the choice `B` (among `A`, `B`, and `C`) if no key press is made within 2 seconds.

## 6. Mount Improvements

### 6.1. Physical CDs mounting support

Mounting physical CDs is now (re-)implemented in DOSBox Staging for better compatibility with games like **Under a Killing Moon**, **System Shock**, and **The Pandora Directive**. The feature is supported in DOSBox SVN but was forced to be dropped from DOSBox Staging earlier during the SDL2 migration process. Now we are able to bring it back utilizing the SDL1 CD support code as an external library, plus restoring the main SDL CD interface from DOSBox.

To use the feature, execute the command `mount -cd` to list all CD drives and their numbers, and use `-usecd NUMBER` parameter to specify a CD drive `NUMBER`, just like you would do in DOSBox SVN. Playing CD audio tracks from physical discs is also supported in Windows as in DOSBox SVN.

### 6.2. Allow read-only mount of disk images

You might have encountered the problem previously that you could not mount disk images which are write-protected, which happened simply because DOSBox Staging required write access for mounting disk images. Sometimes the user may also want to mount a disk image in a read-only manner (so that the content in the disk image will not be changed inside the emulator), even if the disk image itself is not write-protected. We have realized that in either case the requirement for write access is not really needed for mounting disk images, so we have added support for mounting them in a read-only manner, either when the disk image files are read-only or when the `-ro` flag is specified by the users.

### 6.3. Z drive customization and directory support

The internal Z drive that is automatically mounted when you launch DOSBox Staging is now fully customizable, allowing users to add their own files or programs to the drive by putting them in the `drivez` subdirectory inside the DOSBox Staging program directory. Files already existing on the Z drive will be replaced by the user-provided ones, e.g. you can use your own `MEM.COM` or `KEYB.COM` commands instead of the default ones on the Z drive. Moreover, support for one-level subdirectories has been added, allowing users to better organise their files, resulting in a cleaner looking Z drive. The drive's contents can be refreshed via the `RESCAN` command to reflect any changes made to it at the host OS level.

### 6.4. Wildcard support for IMGMOUNT command

The `IMGMOUNT` command allows you to mount disk or CD images, but sometimes you may want to mount multiple images to a single drive, swappble via a keyboard shortcut. Previously you had to specify the names of the all the image files one by one, even if they have some patterns in common (like `DISK1.IMG`, `DISK2.IMG`, `DISK3.IMG`, etc). `IMGMOUNT` command now supports wildcards for mounting image files, so that you can just specify a file pattern that matches all the image files that you want to include. For example, the command `IMGMOUNT a d:\*.img -t floppy` will mount all image files with the IMG extension on `D:\` as floppy images.

### 6.5. Automount resource drives

Directories can now be automounted, provided the `automount` conf setting is enabled (which it is, by default).

These automount directories are single-letter directories, `a` through `y` representing the mounted drive letter (where `z` is reserved for DOSBox's drive) placed inside a local `drives/`, directory, relative to the startup location.  This `drives/` directory can also be placed in a scanned resource location, like your dosbox conf directory or the release package's `resources/` area.

Each drive can be customized with an accompanying `<letter>.conf` to define its mount `type`, `label`, and `path`.  For example, to mount a local `drives/d/` directory as a D:\ CDROM with the label `SIERRA`, the accompanying `d.conf` would contain:

```ini
[drive]
type = cdrom
label = SIERRA
```

A bundled `Y:` automount is provided in the release's `reources/` directory that bundles a couple FreeDOS 3rd party tools (xcopy.com, deltree.com, debug.com) along with an accompanying `y.conf` to add it to the PATH.

Note that this feature doesn't yet support image mounts, such as `.img`, `.bin/cue`, or `.iso`.

## 7. Localization improvements

### 7.1. Code pages and keyboard layouts

The 20 years old FreeDOS code pages (screen fonts) and keyboard layouts were updated to the latest versions, countless of new definitions are now available. For a full list see the documentation:

* [here](https://github.com/dosbox-staging/dosbox-staging/blob/1ae448a58ef03bf9d5b69a3a9017df07ac6029f6/contrib/resources/freedos-cpi/DOC/CODEPAGE.TXT) for the list of available code pages
* [here](https://github.com/dosbox-staging/dosbox-staging/blob/1ae448a58ef03bf9d5b69a3a9017df07ac6029f6/contrib/resources/freedos-keyboard/DOC/LAYOUTS.TXT) for the list of available keyboard layouts

Some notable examples:

* `KEYB bg 3021` - sets a Bulgarian keyboard layout and code page, with Cyrillic characters encoded according to the MIK standard
* `KEYB cz489 867` - a so-called programmer keyboard layout (national characters available with right ALT + number) for Czech and Slovak languages, with Kamenický character encoding - which was more popular than code page 852
* `KEYB de 858` - German keyboard, code page with EUR currency symbol
* `KEYB hu 3845` - Hungarian keyboard, CWI-2 character encoding
* `KEYB pl 668` - code page specially designed for Polish language; places national characters on the same positions as standard code page 852 (so it is compatible with current software and text documents), but preserves more table drawing symbols
* `KEYB pl 667` - Mazovia encoding for Polish language, used mainly by older business software

### 7.2. Country support for different date, time, and decimal formats

The display formats for dates, times, and decimals were previously fixed to the United States style, but this is no longer the case with this new version. Indeed, DOSBox Staging can now display date, time, and decimal formats according to the system locale and country settings, and for example in the Canadian French locale (country code 2) the date and time will be displayed as `2002-10-01 12:34` instead of `10-01-2002 12:34p` as displayed in the United States locale (country code 1). There is a new config option `country` which allows you to manually specify the country code for different date, time, and decimal formats.

### 7.3. Improved detection of local language and keyboard layout

On macOS and Windows systems, local languages now are more robustly detected and applied.

Note that these can still be manually set using the `language` and `keyboardlayout` conf setting when needed, or via the `KEYB` command as mentioned above.

## 8. Input improvements

### 8.1. Mouse wheel emulation

The built-in mouse driver now provides a wheel support for application aware of CuteMouse extensions; examples include <em>Necromancer's DOS Navigator</em> and <em>Mpxplay</em>.

The original CuteMouse driver version 2.1 is also able to use the PS/2 mouse wheel, just start it with `CTMOUSE /o`.

### 8.2. Serial mice emulation

Numerous serial (COM port) mice are now emulated:

* original Microsoft mouse with 2 buttons
* Logitech mouse, with 3 buttons
* wheel mouse with 3 buttons
* Mouse Systems mouse (old mouse type, not compatible with the ones listed above), with 3 buttons

To enable serial mouse type `SERIAL 1 mouse` command (this will attach it to COM1 port), or edit the `[serial]` section of the configuration file. By default DOSBox Staging tries to determine what kind of mouse the game or application expects.

With serial mouse emulation, Windows 1.01 is finally usable!

### 8.3. Windows 3.1 seamless mouse integration

It is now possible to have a seamless mouse integration using one of the following 3rd party VMware-compatible Windows 3.1 mouse drivers:

* [driver](https://git.javispedro.com/cgit/vbados.git/about/) by <em>javispedro</em> - this one requires a corresponding DOS mouse driver to be started; this driver also provides seamless mouse integration for a real DOS if booted inside DOSBox Staging

* [driver](https://github.com/NattyNarwhal/vmwmouse) by <em>NattyNarwhal</em> - does not require any specific DOS driver and has experimental support for mouse wheel, but current version 0.1 has stability problems

For now only the mouse is supported (no VMware directory sharing, etc.), only using VMware protocol (no VirtualBox-only drivers). Windows 9x VMware mouse driver is not supported.

### 8.4. Joystick calibration hotkeys

Most DOS games that offer analog joystick control include some form of calibration. However, some games have poor or limited calibration resulting in the joystick's position drifting or being offset, despite calibration attempts.

To compensate for these rare cases, DOSBox Staging lets you adjust the joystick's X and Y position paramemters in realtime by enabling the `use_joy_calibration_hotkeys` setting in `[joystick]` conf section.

Once activated, you can tap **Ctrl + Arrow-keys** or **Alt + Arrow-keys** to adjust either the joystick's scalar multiplier or absolute offset position, respectively.  These let you "counterbalance" calibration issues in realtime.

Each tap of the hotkeys will log the calibration values for for the given axis. For example:

```text
2022-09-16 09:26:01.141 | JOYSTICK: x_calibration = 0.576211,0.02
or
2022-09-16 09:26:08.845 | JOYSTICK: y_calibration = 0.5474,-0.005
```

Once you've found the optimal settings for a game, the logged calibration values can be placed in the game's local conf file (so the setting are only active for the affeced game). Using the above as an example:

```ini
[joystick]
...
use_joy_calibration_hotkeys = false
joy_x_calibration           = 0.576211,0.02
joy_y_calibration           = 0.5474,-0.005
```

Note that you can disable the calibration hotkeys once you've found settings that work for a problematic game.

Here's a video showing how the calibration hotkeys "pull" the joystick in various directions:

<video controls src="/joystick_calibration_hotkey_demo.webm" width=640> Your browser does not support the <code>video</code> element.</video>

## 9. General improvements

### 9.1. Launch with specified config option(s) from command-line

Some people may want to temporarily run DOSBox Staging with specified config option(s), and in this new version you can do this with the new `-set` command-line option when launching DOSBox Staging, instead of having to modify the configuration file before you start DOSBox Staging. For example, the user can temporarily run DOSBox Staging with the EMS memory disabled with the command line `dosbox -set ems=false`, regardless the current setting in the configuration file. The `-set` option can be specified multiple times for different config options, similar to the `-c` option which can be used multiple times to run multiple commands after DOSBox Staging starts.

### 9.2. Implemented Windows installer for Windows users

Previously DOSBox Staging was only available as portable zip packages for Windows users, but this has changed in this new version - as a Windows user you can now install DOSBox Staging more easily with the installer, which is especially recommended for new and first-time users. When the installer is used the installation process will be automated while allowing you to change certain things like the installation folder, and you will be able to launch DOSBox Staging as soon as the installation ends. Shell context menus can also be automatically added for a faster launch of DOSBox Staging from the Windows Explorer.

### 9.3. Configurable soft-modem connect speed

The soft-modem's reported connect speed can be customized using serial port's `baudrate:` setting. for example:

```ini
serial1 = modem baudrate:2400
```

Although this doesn't actually the underling baud rate, it can help satify old modem software if it's unable to handle (or parse) the larger connect values.

Ref: <https://github.com/dosbox-staging/dosbox-staging/pull/1780>

### 9.4. Workaround for games that corrupt memory

Extremely rare programming bugs in some DOS games (and programs) may cause them to accidentally write data beyond their allocated memory region, similar to "painting outside the lines".  DOSBox is great at catching these instances: it flags the corruption in the memory chain block (MCB) and quits, preventing the program from barreling on possibling doing more harm, such as writing corrupt savegames, documents, and so on.

DOSBox Staging lets you decide how to handle these with the `mcb_fault_strategy` setting. The default setting, `"deny"`, maintains the existing safe behavior of quiting as soon as a fault is detected. You can also choose to `"repair"` MCB corruption (this uses simple logic and only will do 100 corrections), `"report"` MCB corruption (but carry on without repairing it), or `"allow"` MCB corruption without reporting it.

You only need to consider this if your game consistently crashes with MCB chain corruption errors.

## 10. Developer-related improvements

### 10.1. Self-documenting bit-twidling with `bit_view`

We've implemented a `bit_view` C++ class using constant expressions to access a subset of a data-field's bits, allowing them to be read, written, assigned, flipped, cleared, and tested, without the need to for the usual twiddling operations.

Constructing a `bit_view` is similar to a C bitfield, however unlike C bitfields, `bit_view`s are free from undefined behavior and have been proven using GCC's and Clang's undefined behavior sanitizers.

There's more detail and some code examples here: <https://github.com/dosbox-staging/dosbox-staging/pull/1708>.

### 10.2. Memory block and type size simplification

DOS's emulated main memory (up to 64 MiB) and the video card's memory (to up 8 MiB) are both now allocated statically to reduce pressure on heap storage [Ref: PR1714](https://github.com/dosbox-staging/dosbox-staging/pull/1714).

More progress has been made in reducing the use of large variables type-sizes down to purpose-fit sizes per the DOS/hardware specification (typically 8 or 16-bit) [Ref: PR1721](https://github.com/dosbox-staging/dosbox-staging/pull/1721).

### 10.3. Tracy profiler integration

The [Tracy event profiler](https://github.com/wolfpld/tracy) has been integrated into the build system and basic hooks are in place to log frames and tics. These are only active (and not compiled in) unless Tracy is enabled.

Here's what it looks like:

[![tracy](/tracy-min.png)][tracy]

Tracy runtime-profiling DOSBox Staging

It can be enabled at build-time with `-Dtracy=true`. Learn more about it, and how to build the server-side component here: [Ref: PR1749](https://github.com/dosbox-staging/dosbox-staging/pull/1749).

[tracy]: /tracy.png

### 10.4. Continous Integration MSYS2 workflow improvements

The MSY2-based workflow has been brought in line with current best-practices, which dramatically improved its build time and lead to us now using it to generate the default Windows release binaries.

### 10.5. Release-package shell script

Release packages are now generated using a cross-platform POSIX-compliant shell script. With this logic moved into a script, developers can now easily test the creation of a release package locally, which was previously impossible as that logic only lived in a GitHub-syntax YAML.

### 10.6. Static analysis

The team continues to fix address static analysis issues as flagged by various analyzer. Here are our Coverity Scan metrics to-date:

[![Coverity metrics)](/coverity_numbers_2022_09.png)](/coverity_numbers_2022_09.png)

[![Coverity graph)](/coverity_graph_2022_09.png)](/coverity_graph_2022_09.png)

## 11. Translation Updates

* Polish translation is now up to date
TODO

The messaging system now supports self-documenting markup syntax, which is much easier to read and maintain compared to the previous ANSI escape sequences.

ANSI Escape Sequences | Self-documenting markup
:--- | :---
Escribiendo ^[[34;1mdir^[[0m all� mostrar� su contenido. | Digita [color=blue]dir[reset] per visualizzarne il contenuto.

## 12. Bugfixes

* [Fixed](https://github.com/dosbox-staging/dosbox-staging/issues/1722) Ultima Underworld issues with gaming (high polling rate) mice

* Fixed colors becoming very dim on newer Intel integrated GPUs due to Intel's OpenGL drivers not properly handling the sRGB linear color space.

* Fixed a memory-read race condition present during the splash-image display, which also reduced start up time by around 200 ms.

* Fixed display of the low-resolution halfline VESA 2.0 mode used by Extreme Assault through the addition of a new `vesa_mode` conf setting value, named `halfline`.

* Named the macOS application "DOSBox Staging.app" per the macOS per Human Interface Guidelines.

* Fixed a usability trap-door when opening the mapper without mouse support: in these cases, the user was unable to exit the mapper. The mapper now only opens when mouse support is enabled.

## 13. Contributors

TODO

## 14. Thank You

We are extremely grateful for all contributions, including the invaluable improvements merged in from the DOSBox project.
